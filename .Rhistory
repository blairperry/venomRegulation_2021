geom_jitter(width = 0.1,size=1,show.legend = F) +
geom_signif(comparisons = list(c("FALSE", "TRUE")),
map_signif_level = TRUE, textsize=4, tip_length = 0 ,vjust = 0.5) +
scale_fill_manual(values=c('FALSE'='grey','TRUE'='skyblue2')) +
# scale_y_continuous(limits=c(0,max(log10(venom.exp$avg1DPE+1)*1.2))) +
ggtitle('g) SVSPs') +
xlab('H3K4me3 Peak Near Promoter') +
theme_bw() + theme(axis.title.y = element_blank(),plot.title.position = 'plot',plot.title = element_text(face='bold'))
svsp
# svsp.2removed <- ggplot(venom.exp %>% filter(str_detect(txID,'SVSP') & txID != 'crovir-transcript-SVSP_2'),aes(x=ChIPsignal,y=avg1DPE,fill=ChIPsignal)) +
#   geom_boxplot(show.legend = F) +
#   geom_jitter(width = 0.1,size=1,show.legend = F) +
#   geom_signif(comparisons = list(c("FALSE", "TRUE")),
#               map_signif_level = TRUE, textsize=4, tip_length = 0 ,vjust = 0.5) +
#   scale_fill_manual(values=c('FALSE'='grey','TRUE'='skyblue2')) +
#   scale_y_continuous(limits=c(0,max(log10(venom.exp$avg1DPE+1)*1.2))) +
#   ggtitle('g) SVSPs') +
#   xlab('H3K4me3 Peak Near Promoter') +
#   theme_bw() + theme(axis.title.y = element_blank(),plot.title.position = 'plot',plot.title = element_text(face='bold'))
#
# svsp.2removed
pla2 <- ggplot(subset(venom.exp,str_detect(txid,'PLA2') & txid != 'crovir-transcript-PLA2_gIIE'),aes(x=ChIPsignal,y=log10(Median1DPE+1),fill=ChIPsignal)) +
geom_boxplot(show.legend = F) +
geom_jitter(width = 0.1,size=1,show.legend = F) +
geom_signif(comparisons = list(c("FALSE", "TRUE")),
map_signif_level = TRUE, textsize=4, tip_length = 0 ,vjust = .5) +
# scale_y_continuous(limits=c(0,max(log10(venom.exp$avg1DPE+1)*1.2))) +
scale_fill_manual(values=c('FALSE'='grey','TRUE'='skyblue2')) +
ggtitle('h) PLA2s') +
xlab('H3K4me3 Peak Near Promoter') +
ylab('Log10(TPM+1)')+
theme_bw() + theme(plot.title.position = 'plot',plot.title = element_text(face='bold'))
other <- ggplot(subset(venom.exp,str_detect(txid,'SVSP|SVSP|PLA2|128',negate = T)),aes(x=ChIPsignal,y=log10(Median1DPE+1),fill=ChIPsignal)) +
geom_boxplot(show.legend = F) +
geom_jitter(width = 0.1,size=1,show.legend = F) +
geom_signif(comparisons = list(c("FALSE", "TRUE")),
map_signif_level = TRUE, textsize=4, tip_length = 0,vjust = 0.5) +
scale_fill_manual(values=c('FALSE'='grey','TRUE'='skyblue2')) +
# scale_y_continuous(limits=c(0,max(log10(venom.exp$avg1DPE+1)*1.2))) +
xlab('H3K4me3 Peak Near Promoter') +
ggtitle('i) Other VGs') +
theme_bw() + theme(axis.title.y = element_blank(),plot.title.position = 'plot',plot.title = element_text(face='bold'))
#(allGenes + allVen) / (svmp | svsp | pla2 | other)
#(allGenes | allVen | svmp | svsp | pla2 | other) + plot_annotation(tag_levels = 'a' )
(allGenes | allVen) / (svmp | svsp ) / (pla2 | other)
library(tidyverse)
library(ggvenn)
library(patchwork)
svmp.enrich <- read_csv('analysis/5_promoters/_tfbs_analysis/SVMP.vs.NonVen/Enrichment: Text5563405300722031706_MostSigDeficit.csv') %>%
janitor::clean_names() %>%
filter(gene_p_value < 0.05 & gene_representation == 'Up') %>%
mutate(family = 'SVMP')
svsp.enrich <- read_csv('analysis/5_promoters/_tfbs_analysis/SVSP.vs.NonVen/Enrichment: Text1420245787213203463_MostSigDeficit.csv') %>%
janitor::clean_names() %>%
filter(gene_p_value < 0.05 & gene_representation == 'Up')%>%
mutate(family = 'SVSP')
pla2.enrich <- read_csv('analysis/5_promoters/_tfbs_analysis/PLA2.vs.NonVen/Enrichment: Text1784563758267191801_MostSigDeficit.csv') %>%
janitor::clean_names() %>%
filter(gene_p_value < 0.05 & gene_representation == 'Up')%>%
mutate(family = 'PLA2')
forVenn <- list('SVMP'=svmp.enrich$transcription_factor_name,
'SVSP'=svsp.enrich$transcription_factor_name,
'PLA2'=pla2.enrich$transcription_factor_name)
ggvenn(forVenn,fill_color = c('#A3C0CF','#7DCBAC','#A23B5F'),stroke_size = 0.5)
all.enrich <- svmp.enrich %>%
bind_rows(svsp.enrich,pla2.enrich) %>%
mutate(family = factor(family,levels = c('SVMP','SVSP','PLA2')))
ggplot(all.enrich,aes(x=family,y=reorder(transcription_factor_name,desc(transcription_factor_name)), fill=family)) +
geom_point(pch=21,size=6,show.legend = F) +
labs(x='Venom Gene Family',y='TFBS',title = 'Enriched TFBS') +
scale_fill_manual(values = c('PLA2'='#A23B5F','SVSP'='#7DCBAC','SVMP'='#A3C0CF','Other'='grey60'))+
theme_linedraw() + theme(plot.title.position = 'plot')
ggvenn(forVenn,fill_color = c('#A3C0CF','#7DCBAC','#A23B5F'),stroke_size = 0.5)
exp <- read_tsv('./analysis/1_gene_expression/norm_counts/AllGenes_AvgMedianTPM_1DPE_08.02.21.tsv') %>%
select(txid,Median1DPE)
boundThresholds <- read_tsv('analysis/4_atacseq/tobias_footprinting/BoundThresholds_08.11.21.tsv')
rvg11.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG11') %>% select(threshold))
rvg1.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG1') %>% select(threshold))
rvg4.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG4') %>% select(threshold))
svmp.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/SVMP.vs.NonVen/tfbs_aligned/SVMP_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
svsp.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/svsp.vs.NonVen/tfbs_aligned/svsp_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
pla2.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/pla2.vs.NonVen/tfbs_aligned/pla2_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
filter(gene_id != 'PLA2 gIIE') %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
all.boundTFcounts <- svmp.tf.ali %>%
bind_rows(svsp.tf.ali,pla2.tf.ali) %>%
mutate(family = str_split_fixed(gene_id,'[ ]',2)[,1]) %>%
select(family,gene_id,tfbs_id,avg_footprint,tot.bound,Median1DPE) %>%
unique() %>%
filter(tot.bound > 1) %>%
group_by(family,gene_id,tfbs_id,Median1DPE) %>%
tally() %>%
arrange(Median1DPE) %>%
mutate(gene_id = factor(gene_id,levels=unique(.$gene_id)))
all.exp <- svmp.tf.ali %>%
bind_rows(svsp.tf.ali,pla2.tf.ali) %>%
mutate(family = str_split_fixed(gene_id,'[ ]',2)[,1]) %>%
select(family,gene_id,Median1DPE) %>%
unique() %>%
filter(gene_id %in% all.boundTFcounts$gene_id) %>%
arrange(Median1DPE) %>%
mutate(gene_id = factor(gene_id,levels=unique(.$gene_id)))
p1 <- ggplot(all.boundTFcounts,aes(x=tfbs_id,y=gene_id,size=n,color=tfbs_id)) +
geom_point(show.legend = F) +
# scale_size_continuous(range = c(2,8)) +
scale_size_area(max_size = 8) +
facet_grid(rows=vars(family),scales = 'free_y',space='free') +
xlab('TFBS') + ylab('') +
ggtitle('Venom Gene Promoters - Putatively-Bound TFBS') +
theme_linedraw() + theme(axis.text.x = element_text(angle = 45,hjust = 1),legend.position = 'bottom',strip.text.y = element_blank(),plot.title.position = 'plot',plot.title = element_text(face='bold') )
p2 <- ggplot(all.exp,aes(x=log10(Median1DPE+1),y=gene_id)) +
geom_bar(stat='identity',fill='firebrick4') +
facet_grid(rows=vars(family),scales = 'free_y',space='free') +
ylab('') +
theme_linedraw() + theme(panel.grid = element_blank(),axis.title.y = element_blank())
p1 + p2 + plot_layout(widths = c(3,1))
all.boundUnboundTFcounts <- svmp.tf.ali %>%
bind_rows(svsp.tf.ali,pla2.tf.ali) %>%
mutate(family = str_split_fixed(gene_id,'[ ]',2)[,1]) %>%
select(family,gene_id,tfbs_id,avg_footprint,tot.bound,Median1DPE) %>%
unique() %>%
mutate(bound = ifelse(tot.bound > 1,T,F)) %>%
group_by(family,gene_id,tfbs_id,Median1DPE,bound) %>%
tally() %>%
ungroup() %>%
arrange(Median1DPE) %>%
mutate(gene_id = factor(gene_id,levels=unique(.$gene_id)))
all.exp.v2 <- svmp.tf.ali %>%
bind_rows(svsp.tf.ali,pla2.tf.ali) %>%
mutate(family = str_split_fixed(gene_id,'[ ]',2)[,1]) %>%
select(family,gene_id,Median1DPE) %>%
unique() %>%
filter(gene_id %in% all.boundUnboundTFcounts$gene_id) %>%
arrange(Median1DPE) %>%
mutate(gene_id = factor(gene_id,levels=unique(.$gene_id)))
p1.v2 <- ggplot(all.boundUnboundTFcounts,aes(x=tfbs_id,y=gene_id,size=n,color=tfbs_id)) +
geom_point(data=subset(all.boundUnboundTFcounts, bound == F),show.legend = F,pch=1,color='black',size=6) +
geom_point(data=subset(all.boundUnboundTFcounts, bound == T),show.legend = F,size=6) +
# scale_size_continuous(range = c(2,8)) +
scale_size_area(max_size = max(all.boundUnboundTFcounts$n)) +
facet_grid(rows=vars(family),scales = 'free_y',space='free') +
xlab('TFBS') + ylab('') +
ggtitle('Venom Gene Promoters - Putatively-Bound TFBS') +
theme_linedraw() + theme(axis.text.x = element_text(angle = 45,hjust = 1),legend.position = 'bottom',strip.text.y = element_blank(),plot.title.position = 'plot',plot.title = element_text(face='bold') )
p2.v2 <- ggplot(all.exp.v2,aes(x=log10(Median1DPE+1),y=gene_id)) +
geom_bar(stat='identity',fill='firebrick4') +
facet_grid(rows=vars(family),scales = 'free_y',space='free') +
ylab('') +
theme_linedraw() + theme(panel.grid = element_blank(),axis.title.y = element_blank())
p1.v2 + p2.v2 + plot_layout(widths = c(3,1))
library(tidyverse)
library(patchwork)
exp <- read_tsv('./analysis/1_gene_expression/norm_counts/AllGenes_AvgMedianTPM_1DPE_08.02.21.tsv') %>%
select(txid,Median1DPE)
boundThresholds <- read_tsv('analysis/4_atacseq/tobias_footprinting/BoundThresholds_08.11.21.tsv')
rvg11.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG11') %>% select(threshold))
rvg1.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG1') %>% select(threshold))
rvg4.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG4') %>% select(threshold))
# SVMP --------------------------------------------------------------------
svmp.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/SVMP.vs.NonVen/tfbs_aligned/SVMP_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
svmp.cons_score <- read_tsv('./analysis/5_promoters/_tfbs_analysis/SVMP.vs.NonVen/tfbs_aligned/SVMP_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_consScore.txt',col_names = c('position','score'))
svmp.gaps <- read_tsv('./analysis/5_promoters/_tfbs_analysis/SVMP.vs.NonVen/tfbs_aligned/SVMP_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_gaps.txt',col_names = F) %>%
mutate(tx_id = str_split_fixed(X1,'[::]',2)[,1]) %>%
# mutate(X1 = str_remove(X1,'crovir-transcript-')) %>%
filter(tx_id %in% svmp.tf.ali$tx_id) %>%
mutate(tx_id = factor(tx_id,levels=unique(svmp.tf.ali$tx_id))) %>%
mutate(X2 = X2 - 1, X3 = X3 + 1) %>%
select(4,2,3) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' '))
svmp.splits <- svmp.tf.ali %>%
filter(str_detect(tfbs_split,'split')) %>%
mutate(split_num = str_split_fixed(tfbs_split,'_',2)[,2]) %>%
group_by(PER_ID,tfbs_id,avg_footprint,strand) %>%
mutate(split_start = min(end), split_end = max(start)) %>%
select(tfbs=tfbs_id,split_start,split_end) %>%
unique() %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' '))
svmp.p1 <- ggplot(svmp.tf.ali,aes(xmin=start,xmax=end,ymin=0,ymax=avg_footprint*strand,fill=tfbs_id)) +
geom_segment(inherit.aes = F,data=svmp.splits,aes(x=split_start,xend=split_end,y=0.5*avg_footprint*strand,yend=0.5*avg_footprint*strand),lwd=0.75,alpha=0.75) +
geom_rect(data=subset(svmp.tf.ali,tot.bound > 1),alpha=0.75,col='black',lwd=0.25) +
geom_rect(data=subset(svmp.tf.ali,tot.bound <= 1),alpha=0.25,col='black',lwd=0.25) +
geom_segment(inherit.aes = F,aes(y=0,yend=0,x=0,xend=max(svmp.cons_score$position+20)),lwd=0.75,color='grey40') +
geom_segment(data=svmp.gaps,inherit.aes = F,aes(x=X2,xend=X3,y=0,yend=0),color='white',lwd=1,alpha=0.85) +
facet_wrap(~gene_id,ncol = 1,strip.position = 'left') +
ylab('Strand (Pos = 1, Neg = -1) * Footprint Score')+
xlab('Relative Position') +
coord_cartesian(xlim =c(0,max(svmp.tf.ali$end + 15)),clip = 'on',expand = F)+
# scale_fill_identity() +
# scale_color_identity() +
theme_classic(base_size = 16) +
theme(panel.grid.minor = element_blank(),panel.grid.major = element_blank(),
legend.position = 'left',
strip.text.y.left = element_text(angle = 0,color='black',face = 'bold'),
axis.title.x = element_blank(),
axis.text.y=element_text(size=8),
strip.background = element_rect(fill='grey90',size = 0.5),
panel.spacing = unit(0.25, "lines"))
svmp.p1
svmp.p2 <- ggplot(svmp.cons_score,aes(x=position,y=score)) +
geom_area(fill='dodgerblue3',alpha=0.5) +
scale_y_continuous(limits=c(0,1.1))+
coord_cartesian(xlim =c(0,max(svmp.tf.ali$end + 15)),clip = 'on',expand = F)+
# scale_fill_continuous_sequential('Mint') +
ylab('Consensus Score') +
xlab('Relative Position')+
theme_linedraw(base_size = 16) + theme(panel.grid.major.y = element_line(),panel.grid.minor = element_blank(),panel.grid.major.x = element_blank(),legend.position = 'left')
svmp.p3 <- ggplot(svmp.tf.ali %>% select(gene_id,Median1DPE) %>% unique(),aes(x=reorder(gene_id,desc(gene_id)),y=Median1DPE)) +
geom_bar(stat='identity',fill='firebrick4') +
coord_flip() +
scale_y_continuous(expand=c(0,0),limits=c(0,max(svmp.tf.ali$Median1DPE)*1.1),position = 'left') +
theme_classic(base_size = 16) + theme(axis.title.y = element_blank(),axis.title.x = element_blank())
svmp.all <- svmp.p1 + svmp.p3 + svmp.p2 + plot_spacer() + plot_layout(heights = c(4,1),widths = c(5,1),nrow = 2)
svmp.all
svsp.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/svsp.vs.NonVen/tfbs_aligned/svsp_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
svsp.cons_score <- read_tsv('./analysis/5_promoters/_tfbs_analysis/svsp.vs.NonVen/tfbs_aligned/svsp_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_consScore.txt',col_names = c('position','score'))
svsp.gaps <- read_tsv('./analysis/5_promoters/_tfbs_analysis/svsp.vs.NonVen/tfbs_aligned/svsp_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_gaps.txt',col_names = F) %>%
mutate(tx_id = str_split_fixed(X1,'[::]',2)[,1]) %>%
# mutate(X1 = str_remove(X1,'crovir-transcript-')) %>%
filter(tx_id %in% svsp.tf.ali$tx_id) %>%
mutate(tx_id = factor(tx_id,levels=unique(svsp.tf.ali$tx_id))) %>%
mutate(X2 = X2 - 1, X3 = X3 + 1) %>%
select(4,2,3) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' '))
svsp.splits <- svsp.tf.ali %>%
filter(str_detect(tfbs_split,'split')) %>%
mutate(split_num = str_split_fixed(tfbs_split,'_',2)[,2]) %>%
group_by(PER_ID,tfbs_id,avg_footprint,strand) %>%
mutate(split_start = min(end), split_end = max(start)) %>%
select(tfbs=tfbs_id,split_start,split_end) %>%
unique() %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' '))
svsp.p1 <- ggplot(svsp.tf.ali,aes(xmin=start,xmax=end,ymin=0,ymax=avg_footprint*strand,fill=tfbs_id)) +
geom_segment(inherit.aes = F,data=svsp.splits,aes(x=split_start,xend=split_end,y=0.5*avg_footprint*strand,yend=0.5*avg_footprint*strand),lwd=0.75,alpha=0.75) +
geom_rect(data=subset(svsp.tf.ali,tot.bound > 1),alpha=0.65,col='black',lwd=0.25) +
geom_rect(data=subset(svsp.tf.ali,tot.bound <= 1),alpha=0.25,col='black',lwd=0.25) +
geom_segment(inherit.aes = F,aes(y=0,yend=0,x=0,xend=max(svsp.cons_score$position+20)),lwd=0.75,color='grey40') +
geom_segment(data=svsp.gaps,inherit.aes = F,aes(x=X2,xend=X3,y=0,yend=0),color='white',lwd=1,alpha=0.85) +
facet_wrap(~gene_id,ncol = 1,strip.position = 'left') +
ylab('Strand (Pos = 1, Neg = -1) * Footprint Score')+
xlab('Relative Position') +
coord_cartesian(xlim =c(0,max(svsp.tf.ali$end + 15)),clip = 'on',expand = F)+
# scale_fill_identity() +
# scale_color_identity() +
theme_classic(base_size = 16) +
theme(panel.grid.minor = element_blank(),panel.grid.major = element_blank(),
legend.position = 'left',
strip.text.y.left = element_text(angle = 0,color='black',face = 'bold'),
axis.title.x = element_blank(),
axis.text.y=element_text(size=8),
strip.background = element_rect(fill='grey90',size = 0.5),
panel.spacing = unit(0.25, "lines"))
svsp.p1
svsp.p2 <- ggplot(svsp.cons_score,aes(x=position,y=score)) +
geom_area(fill='dodgerblue3',alpha=0.5) +
scale_y_continuous(limits=c(0,1.1))+
coord_cartesian(xlim =c(0,max(svsp.tf.ali$end + 15)),clip = 'on',expand = F)+
# scale_fill_continuous_sequential('Mint') +
ylab('Consensus Score') +
xlab('Relative Position')+
theme_linedraw(base_size = 16) + theme(panel.grid.major.y = element_line(),panel.grid.minor = element_blank(),panel.grid.major.x = element_blank(),legend.position = 'left')
svsp.p3 <- ggplot(svsp.tf.ali %>% select(gene_id,Median1DPE) %>% unique(),aes(x=reorder(gene_id,desc(gene_id)),y=Median1DPE)) +
geom_bar(stat='identity',fill='firebrick4') +
coord_flip() +
scale_y_continuous(expand=c(0,0),limits=c(0,max(svsp.tf.ali$Median1DPE)*1.1),position = 'left') +
theme_classic(base_size = 16) + theme(axis.text.y = element_blank(),axis.title.y = element_blank(),axis.title.x = element_blank())
svsp.all <- svsp.p1 + svsp.p3 + svsp.p2 + plot_spacer() + plot_layout(heights = c(4,1),widths = c(5,1),nrow = 2)
svsp.all
pla2.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/pla2.vs.NonVen/tfbs_aligned/pla2_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
filter(gene_id != 'PLA2 gIIE') %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
pla2.cons_score <- read_tsv('./analysis/5_promoters/_tfbs_analysis/pla2.vs.NonVen/tfbs_aligned/pla2_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_consScore.txt',col_names = c('position','score'))
pla2.gaps <- read_tsv('./analysis/5_promoters/_tfbs_analysis/pla2.vs.NonVen/tfbs_aligned/pla2_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_gaps.txt',col_names = F) %>%
mutate(tx_id = str_split_fixed(X1,'[::]',2)[,1]) %>%
# mutate(X1 = str_remove(X1,'crovir-transcript-')) %>%
filter(tx_id %in% pla2.tf.ali$tx_id) %>%
mutate(tx_id = factor(tx_id,levels=unique(pla2.tf.ali$tx_id))) %>%
mutate(X2 = X2 - 1, X3 = X3 + 1) %>%
select(4,2,3) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
filter(gene_id != 'PLA2 gIIE')
pla2.splits <- pla2.tf.ali %>%
filter(str_detect(tfbs_split,'split')) %>%
mutate(split_num = str_split_fixed(tfbs_split,'_',2)[,2]) %>%
group_by(PER_ID,tfbs_id,avg_footprint,strand) %>%
mutate(split_start = min(end), split_end = max(start)) %>%
select(tfbs=tfbs_id,split_start,split_end) %>%
unique() %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
filter(gene_id != 'PLA2 gIIE')
pla2.p1 <- ggplot(pla2.tf.ali,aes(xmin=start,xmax=end,ymin=0,ymax=avg_footprint*strand,fill=tfbs_id)) +
geom_segment(inherit.aes = F,data=pla2.splits,aes(x=split_start,xend=split_end,y=0.5*avg_footprint*strand,yend=0.5*avg_footprint*strand),lwd=0.75,alpha=0.75) +
geom_rect(data=subset(pla2.tf.ali,tot.bound > 1),alpha=0.65,col='black',lwd=0.25) +
geom_rect(data=subset(pla2.tf.ali,tot.bound <= 1),alpha=0.25,col='black',lwd=0.25) +
geom_segment(inherit.aes = F,aes(y=0,yend=0,x=0,xend=max(pla2.cons_score$position+20)),lwd=0.75,color='grey40') +
geom_segment(data=pla2.gaps,inherit.aes = F,aes(x=X2,xend=X3,y=0,yend=0),color='white',lwd=1,alpha=0.85) +
facet_wrap(~gene_id,ncol = 1,strip.position = 'left') +
ylab('Strand (Pos = 1, Neg = -1) * Footprint Score')+
xlab('Relative Position') +
coord_cartesian(xlim =c(0,max(pla2.tf.ali$end + 15)),clip = 'on',expand = F)+
# scale_fill_identity() +
# scale_color_identity() +
theme_classic(base_size = 16) +
theme(panel.grid.minor = element_blank(),panel.grid.major = element_blank(),
legend.position = 'left',
strip.text.y.left = element_text(angle = 0,color='black',face = 'bold'),
axis.title.x = element_blank(),
axis.text.y=element_text(size=8),
strip.background = element_rect(fill='grey90',size = 0.5),
panel.spacing = unit(0.25, "lines"))
pla2.p1
pla2.p2 <- ggplot(pla2.cons_score,aes(x=position,y=score)) +
geom_area(fill='dodgerblue3',alpha=0.5) +
scale_y_continuous(limits=c(0,1.1))+
coord_cartesian(xlim =c(0,max(pla2.tf.ali$end + 15)),clip = 'on',expand = F)+
# scale_fill_continuous_sequential('Mint') +
ylab('Consensus Score') +
xlab('Relative Position')+
theme_linedraw(base_size = 16) + theme(panel.grid.major.y = element_line(),panel.grid.minor = element_blank(),panel.grid.major.x = element_blank(),legend.position = 'left')
pla2.p3 <- ggplot(pla2.tf.ali %>% select(gene_id,Median1DPE) %>% unique(),aes(x=reorder(gene_id,desc(gene_id)),y=Median1DPE)) +
geom_bar(stat='identity',fill='firebrick4') +
coord_flip() +
scale_y_continuous(expand=c(0,0),limits=c(0,max(pla2.tf.ali$Median1DPE)*1.1),position = 'left') +
theme_classic(base_size = 16) + theme(axis.text.y = element_blank(),axis.title.y = element_blank(),axis.title.x = element_blank())
pla2.all <- pla2.p1 + pla2.p3 + pla2.p2 + plot_spacer() + plot_layout(heights = c(4,1),widths = c(5,1),nrow = 2)
pla2.all
library(tidyverse)
library(ggvenn)
library(patchwork)
svmp.enrich <- read_csv('analysis/5_promoters/_tfbs_analysis/SVMP.vs.NonVen/Enrichment: Text5563405300722031706_MostSigDeficit.csv') %>%
janitor::clean_names() %>%
filter(gene_p_value < 0.05 & gene_representation == 'Up') %>%
mutate(family = 'SVMP')
svsp.enrich <- read_csv('analysis/5_promoters/_tfbs_analysis/SVSP.vs.NonVen/Enrichment: Text1420245787213203463_MostSigDeficit.csv') %>%
janitor::clean_names() %>%
filter(gene_p_value < 0.05 & gene_representation == 'Up')%>%
mutate(family = 'SVSP')
pla2.enrich <- read_csv('analysis/5_promoters/_tfbs_analysis/PLA2.vs.NonVen/Enrichment: Text1784563758267191801_MostSigDeficit.csv') %>%
janitor::clean_names() %>%
filter(gene_p_value < 0.05 & gene_representation == 'Up')%>%
mutate(family = 'PLA2')
forVenn <- list('SVMP'=svmp.enrich$transcription_factor_name,
'SVSP'=svsp.enrich$transcription_factor_name,
'PLA2'=pla2.enrich$transcription_factor_name)
ggvenn(forVenn,fill_color = c('#A3C0CF','#7DCBAC','#A23B5F'),stroke_size = 0.5)
all.enrich <- svmp.enrich %>%
bind_rows(svsp.enrich,pla2.enrich) %>%
mutate(family = factor(family,levels = c('SVMP','SVSP','PLA2')))
ggplot(all.enrich,aes(x=family,y=reorder(transcription_factor_name,desc(transcription_factor_name)), fill=family)) +
geom_point(pch=21,size=6,show.legend = F) +
labs(x='Venom Gene Family',y='TFBS',title = 'Enriched TFBS') +
scale_fill_manual(values = c('PLA2'='#A23B5F','SVSP'='#7DCBAC','SVMP'='#A3C0CF','Other'='grey60'))+
theme_linedraw() + theme(plot.title.position = 'plot')
# Bound/Unbound TFBS Plots ------------------------------------------------
exp <- read_tsv('./analysis/1_gene_expression/norm_counts/AllGenes_AvgMedianTPM_1DPE_08.02.21.tsv') %>%
select(txid,Median1DPE)
boundThresholds <- read_tsv('analysis/4_atacseq/tobias_footprinting/BoundThresholds_08.11.21.tsv')
rvg11.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG11') %>% select(threshold))
rvg1.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG1') %>% select(threshold))
rvg4.thresh <- as.numeric(boundThresholds %>% filter(sample=='RVG4') %>% select(threshold))
# SVMP --------------------------------------------------------------------
svmp.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/SVMP.vs.NonVen/tfbs_aligned/SVMP_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
svsp.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/svsp.vs.NonVen/tfbs_aligned/svsp_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
pla2.tf.ali <- read_tsv('./analysis/5_promoters/_tfbs_analysis/pla2.vs.NonVen/tfbs_aligned/pla2_PromPeaks_seqs_08.14.21.aln.mafft.singleLine_alignTFBS.txt',
col_names = c('PER_ID','start','end','tfbs_split','strand','RVG11_Footprint','RVG1_Footprint','RVG4_Footprint','MA_ID')) %>%
mutate(tfbs_id = str_split_fixed(tfbs_split,'_',2)[,1]) %>%
mutate(tx_id = str_split_fixed(PER_ID,'[::]',2)[,1]) %>%
left_join(exp,by=c('tx_id'='txid')) %>%
arrange(-Median1DPE) %>%
mutate(gene_id = str_remove(tx_id,'crovir-transcript-')) %>%
mutate(gene_id = str_replace_all(gene_id,'_',' ')) %>%
filter(gene_id != 'PLA2 gIIE') %>%
mutate(avg_footprint = rowMeans(.[,6:8])) %>%
mutate(RVG11.bound = ifelse(RVG11_Footprint >= rvg11.thresh,1,0),
RVG1.bound = ifelse(RVG1_Footprint >= rvg1.thresh,1,0),
RVG4.bound = ifelse(RVG4_Footprint >= rvg4.thresh,1,0)) %>%
mutate(tot.bound = rowSums(.[,15:17]))
## Experimenting with other plot formats
all.boundTFcounts <- svmp.tf.ali %>%
bind_rows(svsp.tf.ali,pla2.tf.ali) %>%
mutate(family = str_split_fixed(gene_id,'[ ]',2)[,1]) %>%
select(family,gene_id,tfbs_id,avg_footprint,tot.bound,Median1DPE) %>%
unique() %>%
filter(tot.bound > 1) %>%
group_by(family,gene_id,tfbs_id,Median1DPE) %>%
tally() %>%
arrange(Median1DPE) %>%
mutate(gene_id = factor(gene_id,levels=unique(.$gene_id)))
all.exp <- svmp.tf.ali %>%
bind_rows(svsp.tf.ali,pla2.tf.ali) %>%
mutate(family = str_split_fixed(gene_id,'[ ]',2)[,1]) %>%
select(family,gene_id,Median1DPE) %>%
unique() %>%
filter(gene_id %in% all.boundTFcounts$gene_id) %>%
arrange(Median1DPE) %>%
mutate(gene_id = factor(gene_id,levels=unique(.$gene_id)))
p1 <- ggplot(all.boundTFcounts,aes(x=tfbs_id,y=gene_id,size=n,color=tfbs_id)) +
geom_point(show.legend = F) +
# scale_size_continuous(range = c(2,8)) +
scale_size_area(max_size = 8) +
facet_grid(rows=vars(family),scales = 'free_y',space='free') +
xlab('TFBS') + ylab('') +
ggtitle('Venom Gene Promoters - Putatively-Bound TFBS') +
theme_linedraw() + theme(axis.text.x = element_text(angle = 45,hjust = 1),legend.position = 'bottom',strip.text.y = element_blank(),plot.title.position = 'plot',plot.title = element_text(face='bold') )
p2 <- ggplot(all.exp,aes(x=log10(Median1DPE+1),y=gene_id)) +
geom_bar(stat='identity',fill='firebrick4') +
facet_grid(rows=vars(family),scales = 'free_y',space='free') +
ylab('') +
theme_linedraw() + theme(panel.grid = element_blank(),axis.title.y = element_blank())
p1 + p2 + plot_layout(widths = c(3,1))
