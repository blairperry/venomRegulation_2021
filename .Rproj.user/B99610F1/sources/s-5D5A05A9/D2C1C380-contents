
library(tidyverse)
library(readxl)
library(pheatmap)
library(viridis)

setwd("~/Dropbox/CastoeLabFolder/projects/CVV_Gene_Regulation/_VenomGeneRegulation/data/venom_annotations/___PriorityVenomGenes_Sept2020")


ven.annot <- read_xlsx('/Users/perryb/Dropbox/CastoeLabFolder/projects/CVV_Gene_Regulation/_VenomGeneRegulation/data/venom_annotations/fullVenomAnnotation_02.20.20.xlsx',col_names = F)
norm.counts <- read_csv('/Users/perryb/Dropbox/CastoeLabFolder/projects/CVV_Gene_Regulation/_VenomGeneRegulation/data/rnaseq/norm_counts/cvv_VenomRNAseq_NormCounts_updatedGFF_FullVenomAnnot_TxIDonly_01.14.20.csv')

allven.normcounts <- norm.counts %>% filter(X1 %in% ven.annot$...6)
too.low <- ven.annot %>% filter(!(...6 %in% allven.normcounts$X1))

allven.normcounts2 <- as.data.frame(allven.normcounts[,-1])
row.names(allven.normcounts2) <- allven.normcounts$X1

pheatmap(allven.normcounts2,scale='row')


### Read in venom vs. non-venom pairwise tests

ven.vs.nonven <- read_csv('/Users/perryb/Dropbox/CastoeLabFolder/projects/CVV_Gene_Regulation/_VenomGeneRegulation/data/rnaseq/pairwise_results/cvv_Venom.vs.NonVenom_VG_PairwiseResult_11.19.19.csv') %>% 
  filter(IHW_pvalue < 0.05) %>% 
  filter(log2FoldChange > 0) %>% 
  mutate(txid = str_split_fixed(X1,'_',2)[,2])


upreg.ven.annot <- ven.annot %>% 
  filter(...6 %in% ven.vs.nonven$txid) %>% 
  filter(...4 != 'Myotoxin/crotamine') %>%  # excluding this annotation because it is wrong
  select(chr = 1, start = 2, end = 3, annotation = 4, gff_id = 5, transcript_id = 6)

write_tsv(upreg.ven.annot,'PriorityVenomGeneList_09.29.20.txt',col_names = F)

